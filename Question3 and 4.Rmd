---
title: "IDA Assignment 1"
output: html_document
---

## 1.
### (a) (ii) 0.3
###

### (b) (ii) The probability of ALQ being missing is independent of the Yes/No value of ALQ after adjusting for gender.
### Since ALQ is MAR, hence the missing values in ALQ dosen't depend on themselves, and they should depend on other observed variable and data. So, (i) and (iii) are both incorrect.

###(c) (iii) It is impossible to conclude from the information given.
### 

## 2.The largest possible subsample is 90, and the smallest subsample is 0.
### The dataset consists of 100 subjects and 10 variables. Each variable contains 10% of missing values. If 10% missing values of each variable are the same position, there will be the largest possible subsample,90. If 10% missing values of each variable are the different position totally, there will be the smallest possible subsample,0.

## 3.
### (a) MAR

```{r}
#Question 3
# (a)
set.seed(111)
n<- 500
mu1<-mu2<-mu3<-0
sigma1<-sigma2<-sigma3<-1
z1<-rnorm(n,mu1,sigma1)
z2<-rnorm(n,mu2,sigma2)
z3<-rnorm(n,mu3,sigma3)

Y1<-1+z1
Y2<-5+2*z1+z2

#MAR
Y2_MAR_obs <- Y2[2*z1 +z3 >= 0]
mean(Y2_MAR_obs)

Y2_MAR_mis <- Y2[2*z1 +z3<0]
plot(density(Y2), lwd = 2, col = "blue", main = "MAR", ylim = c(0,0.3))
lines(density(Y2_MAR_obs), lwd = 2, col = "red")
legend(6, 0.3,legend = c("Complete data", "Observed data"),cex=0.8,
       col = c("blue", "red"), lty = c(1, 1), lwd = c(2, 2), bty = "n")

ind_MAR <- which(2*z1 +z3 >= 0) 
g1_MAR <- Y1[ind_MAR] 
g2_MAR <- Y1[-ind_MAR]
mean(g1_MAR)
mean(g2_MAR)
t.test(g1_MAR, g2_MAR, paired = FALSE, var.equal = FALSE)

```
## Question 3
## (b)

```{r}
#Question 3
# (b)
n<- 500
mu1<-mu2<-mu3<-0
sigma1<-sigma2<-sigma3<-1
z1<-rnorm(n,mu1,sigma1)
z2<-rnorm(n,mu2,sigma2)
z3<-rnorm(n,mu3,sigma3)

Y1<-1+z1
Y2<-5+2*z1+z2

Y2[2*z1 +z3<0]=NA

data<-data.frame(Y1=c(Y1), Y2=c(Y2))

fit <- lm(Y2 ~ Y1, data = data) 
summary(fit)
fit$coefficients

set.seed(111)
predicted_sri <- predict(fit, newdata = data) + rnorm(nrow(data), 0, sigma(fit))
Y2_sri <- ifelse(is.na(data$Y2), predicted_sri, data$Y2)

sd(data$Y2, na.rm = TRUE)
sd(Y2_sri)

plot(density(data$Y2[-which(is.na(data$Y2) == TRUE)]), lwd = 2, col = "blue", main = "Stochastic regression imputation", ylim = c(0,0.3))
lines(density(Y2_sri), lwd = 2, col = "red")
legend(6, 0.3,legend = c("Complete data", "Completed data(after imputation)"),cex=0.8,
       col = c("blue", "red"), lty = c(1, 1), lwd = c(2, 2), bty = "n")

```

## Question 3
## (c)

```{r}
#Question 3
# (c)
n<- 500
mu1<-mu2<-mu3<-0
sigma1<-sigma2<-sigma3<-1
z1<-rnorm(n,mu1,sigma1)
z2<-rnorm(n,mu2,sigma2)
z3<-rnorm(n,mu3,sigma3)

Y1<-1+z1
Y2<-5+2*z1+z2

#MNAR
Y2_MNAR_obs <- Y2[2*Y2-10+z3 >= 0]
Y2_MNAR_mis <- Y2[2*Y2-10+z3 < 0]

plot(density(Y2), lwd = 2, col = "blue", main = "MNAR", ylim = c(0,0.5))
lines(density(Y2_MNAR_obs), lwd = 2, col = "red")
legend(8, 0.5,legend = c("Complete data", "Observed data"),cex=0.8,
       col = c("blue", "red"), lty = c(1, 1), lwd = c(2, 2), bty = "n")
```

## Question 3
## (d)

```{r}
#Question 3
# (d)
n<- 500
mu1<-mu2<-mu3<-0
sigma1<-sigma2<-sigma3<-1
z1<-rnorm(n,mu1,sigma1)
z2<-rnorm(n,mu2,sigma2)
z3<-rnorm(n,mu3,sigma3)

Y1<-1+z1
Y2<-5+2*z1+z2

Y2[2*Y2-10+z3 < 0]=NA

data<-data.frame(Y1=c(Y1), Y2=c(Y2))

fit <- lm(Y2 ~ Y1, data = data) 
summary(fit)
fit$coefficients

set.seed(111)
predicted_sri <- predict(fit, newdata = data) + rnorm(nrow(data), 0, sigma(fit))
Y2_sri <- ifelse(is.na(data$Y2), predicted_sri, data$Y2)

sd(data$Y2, na.rm = TRUE)
sd(Y2_sri)

plot(density(data$Y2[-which(is.na(data$Y2) == TRUE)]), lwd = 2, col = "blue", main = "Stochastic regression imputation", ylim = c(0,0.5))
lines(density(Y2_sri), lwd = 2, col = "red")
legend(8, 0.5,legend = c("Complete data", "Completed data(after imputation)"),cex=0.8,
       col = c("blue", "red"), lty = c(1, 1), lwd = c(2, 2), bty = "n")

```

## 4.
### (a) The mean value of the recovery time provided by a complete case analysis is 19.27273 and the associated standard error is 2.603013.
### The correlations between the recovery time and the dose is 0.2391256, and the correlations between the recovery time and the blood pressure is -0.01952862.

```{r}
load("databp.Rdata")
recov<- which(is.na(databp$recovtime) == FALSE)
merecov<-mean(databp$recovtime, na.rm = TRUE)
serecov<-sd(databp$recovtime, na.rm = TRUE)/sqrt(length(recov))

cor1<-cor(databp$recov, databp$logdose, use = "complete")
cor2<-cor(databp$recov, databp$bloodp, use = "complete")

merecov
serecov
cor1
cor2
```

### (b) The mean value of the recovery time provided by a complete case analysis is 19.27273 and the associated standard error is 2.284135.
### The correlations between the recovery time and the dose is 0.2150612, and the correlations between the recovery time and the blood pressure is -0.01934126.

```{r}
re_mi <- ifelse(is.na(databp$recovtime), mean(databp$recovtime, na.rm = TRUE), databp$recovtime)

mearecov<-mean(re_mi)
searecov<-sd(re_mi)/sqrt(length(re_mi))
cor1<-cor(re_mi, databp$logdose)
cor2<-cor(re_mi, databp$bloodp)

mearecov
searecov
cor1
cor2
```

### (c) The mean value of the recovery time provided by a complete case analysis is 19.44428 and the associated standard error is 2.312845.
### The correlations between the recovery time and the dose is 0.2801835, and the correlations between the recovery time and the blood pressure is -0.0111364.

```{r}
fit <- lm(recovtime ~ logdose+bloodp, data = databp) 

predicted_ri <- predict(fit, newdata = databp)
re_ri <- ifelse(is.na(databp$recovtime), predicted_ri, databp$recovtime)

merrecov<-mean(re_ri)
serrecov<-sd(re_ri)/sqrt(length(re_ri))
cor1<-cor(re_ri, databp$logdose)
cor2<-cor(re_ri, databp$bloodp)

merrecov
serrecov
cor1
cor2
```

### (d) The mean value of the recovery time provided by a complete case analysis is 18.24385 and the associated standard error is 2.692533.
### The correlations between the recovery time and the dose is 0.34809, and the correlations between the recovery time and the blood pressure is -0.01829532.

```{r}
fit <- lm(recovtime ~ logdose+bloodp, data = databp) 

set.seed(111)
predicted_sri <- predict(fit, newdata = databp) + rnorm(nrow(databp), 0, sigma(fit))
re_sri <- ifelse(is.na(databp$recovtime), predicted_sri, databp$recovtime)

mesrecov<-mean(re_sri)
sesrecov<-sd(re_sri)/sqrt(length(re_sri))
cor1<-cor(re_sri, databp$logdose)
cor2<-cor(re_sri, databp$bloodp)

mesrecov
sesrecov
cor1
cor2
```

### (e)
```{r}
mis_donors_1<- which(is.na(databp$recovtime) == TRUE)
obs_donors_1<- which(is.na(databp$recovtime) == FALSE)

fit <- lm(recovtime ~ logdose+bloodp, data = databp) 
predicted_re<-predict(fit,newdata=databp)
y <- predicted_re[-c(4,10,22)]
pre_4<-predicted_re[4]

#for (i in 1:22) {
#  if (min((y[i])^2-(pre_4^2)))
#}

```











